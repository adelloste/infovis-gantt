"use strict";function uuidv4(){var t=crypto.getRandomValues(new Uint16Array(8)),a=0;return"00-0-4-1-000".replace(/[^-]/g,(function(e){return(t[a++]+65536*e>>e).toString(16).padStart(4,"0")}))}var margin={top:0,right:30,bottom:50,left:40},width=1024,height=400,xOffset=10,deltaX=null,deltaY=null,dragX=null,dragY=null,color=d3.scaleOrdinal(d3.schemeCategory10),xScale=d3.scaleTime().range([margin.right,width-margin.left]),yScale=d3.scaleBand().range([margin.top,height-margin.bottom]),svg=d3.select("body").append("svg").attr("width",width).attr("height",height).attr("id",uuidv4()).attr("class","gantt-svg").attr("transform","translate("+margin.left+","+margin.top+")"),tooltip=d3.select("body").append("div").attr("class","svg-tooltip").style("position","absolute").style("visibility","hidden");function updateXScaleDomain(t){xScale.domain([new Date("2021-01-01"),new Date("2021-01-31")]).clamp(!0)}function updateYScaleDomain(t){yScale.domain(t.map((function(t){return t.room})))}function drawXAxis(){var t=d3.axisBottom().scale(xScale).ticks(d3.utcDay,1).tickFormat(d3.timeFormat("%b %d")).tickSize(12,0,0);svg.append("g").transition().duration(500).attr("transform","translate("+[xOffset,height-margin.bottom]+")").call(t).selectAll("text").attr("transform","rotate(45)").style("text-anchor","start")}function drawYAxis(){var t=d3.axisLeft().scale(yScale);svg.append("g").transition().duration(500).attr("transform","translate("+[margin.left,0]+")").call(t)}function drawVerticalLines(){svg.append("g").selectAll("line").data(xScale.ticks(d3.utcDay,1)).join("line").attr("stroke","#E4E4E4").attr("x1",(function(t){return xScale(new Date(t))+xOffset})).attr("x2",(function(t){return xScale(new Date(t))+xOffset})).attr("y1",margin.top).attr("y2",height-margin.bottom)}function dragStarted(t){var a=d3.select(this).raise().attr("stroke","black");deltaX=a.attr("x")-t.x,dragX=d3.select(this).attr("x"),deltaY=a.attr("y")-t.y,dragY=d3.select(this).attr("y")}function dragged(t,a){var e=xScale(new Date(a.initDate)),r=(xScale(new Date(a.endDate)),margin.right,yScale.bandwidth()),n=(t.x,t.y),i=round(Math.max(0,Math.min(height-r-margin.bottom,n)),r);d3.select(this).attr("y",i),tooltip.style("visibility","hidden")}function round(t,a){return t%a<a/2?t-t%a:t+a-t%a}function dragEnded(t,a){var e=!1,r=parseFloat(d3.select(this).attr("x")),n=parseInt(d3.select(this).attr("y")),i=parseFloat(d3.select(this).attr("width")),d=r+i;svg.selectAll(".rect").each((function(t,i){var l=parseFloat(d3.select(this).attr("x")),s=parseInt(d3.select(this).attr("y")),o=l+parseFloat(d3.select(this).attr("width"));e||t.id===a.id||n!==s||(r>=l&&r<o||d>l&&d<=o||r<l&&d>o)&&(e=!0)})),d3.select(this).attr("stroke",null),e&&(d3.select(this).attr("y",dragY),e=!1)}function drawBars(t){var a=yScale.bandwidth();svg.append("g").selectAll("rect").data(t).join((function(t){return t.append("rect").attr("class","rect").attr("fill",(function(t,a){return color(a)})).attr("width",0).attr("height",a).attr("x",(function(t){return xScale(new Date(t.initDate))+1*xOffset})).attr("y",(function(t){return yScale(t.room)})).call((function(t){return t.transition().delay((function(t,a){return 60*a})).attr("width",(function(t){var a=xScale(new Date(t.initDate));return xScale(new Date(t.endDate))-a}))}),(function(t){return t.transition().delay((function(t,a){return 60*a})).attr("width",(function(t){var a=xScale(new Date(t.initDate));return xScale(new Date(t.endDate))-a})).attr("height",a).attr("y",(function(t){return xScale(t.room)+a/2}))}),(function(t){return t.transition().delay((function(t,a){return 60*a})).attr("width",0).remove()}))})).call(d3.drag().on("start",dragStarted).on("drag",dragged).on("end",dragEnded))}function draw(t){updateXScaleDomain(t),updateYScaleDomain(t),drawXAxis(),drawYAxis(),drawVerticalLines(),drawBars(t)}d3.json("assets/stubs/reservations.json").then((function(t){draw(t)}));