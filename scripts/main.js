"use strict";function ownKeys(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,r)}return a}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(a),!0).forEach((function(e){_defineProperty(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function uuidv4(){var t=crypto.getRandomValues(new Uint16Array(8)),e=0;return"00-0-4-1-000".replace(/[^-]/g,(function(a){return(t[e++]+65536*a>>a).toString(16).padStart(4,"0")}))}var margin={top:0,right:30,bottom:50,left:40},width=1024,height=400,xOffset=10,deltaX=null,deltaY=null,dragX=null,dragY=null,dataCases=null,color=d3.scaleOrdinal(d3.schemeCategory10),xScale=d3.scaleTime().range([margin.right,width-margin.left]),yScale=d3.scaleBand().range([margin.top,height-margin.bottom]),svg=d3.select("body").append("svg").attr("width",width).attr("height",height).attr("id",uuidv4()).attr("class","gantt-svg").attr("transform","translate("+margin.left+","+margin.top+")"),tooltip=d3.select("body").append("div").attr("class","svg-tooltip").style("position","absolute").style("visibility","hidden");function updateXScaleDomain(t){xScale.domain([new Date("2021-01-01"),new Date("2021-01-31")]).clamp(!0)}function updateYScaleDomain(t){yScale.domain(t.map((function(t){return t.room})))}function scaleBandInvert(t){var e=t.domain(),a=t(e[0]),r=t.step();return function(t){var n=Math.floor((t-a)/r);return e[Math.max(0,Math.min(n,e.length-1))]}}function drawXAxis(){var t=d3.axisBottom().scale(xScale).ticks(d3.utcDay,1).tickFormat(d3.timeFormat("%b %d")).tickSize(12,0,0);svg.append("g").transition().duration(500).attr("transform","translate("+[xOffset,height-margin.bottom]+")").call(t).selectAll("text").attr("transform","rotate(45)").style("text-anchor","start")}function drawYAxis(){var t=d3.axisLeft().scale(yScale);svg.append("g").transition().duration(500).attr("transform","translate("+[margin.left,0]+")").call(t)}function drawVerticalLines(){svg.append("g").selectAll("line").data(xScale.ticks(d3.utcDay,1)).join("line").attr("stroke","#E4E4E4").attr("x1",(function(t){return xScale(new Date(t))+xOffset})).attr("x2",(function(t){return xScale(new Date(t))+xOffset})).attr("y1",margin.top).attr("y2",height-margin.bottom)}function dragStarted(t){var e=d3.select(this).raise().attr("stroke","black");deltaX=e.attr("x")-t.x,dragX=d3.select(this).attr("x"),deltaY=e.attr("y")-t.y,dragY=d3.select(this).attr("y")}function dragged(t,e){var a=xScale(new Date(e.initDate)),r=(xScale(new Date(e.endDate)),margin.right,yScale.bandwidth()),n=(t.x,t.y),i=round(Math.max(0,Math.min(height-r-margin.bottom,n)),r);d3.select(this).attr("y",i),tooltip.style("visibility","hidden")}function round(t,e){return t%e<e/2?t-t%e:t+e-t%e}function dragEnded(t,e){var a=!1,r=parseFloat(d3.select(this).attr("x")),n=parseInt(d3.select(this).attr("y")),i=parseFloat(d3.select(this).attr("width")),o=r+i;if(svg.selectAll(".rect").each((function(t,i){var d=parseFloat(d3.select(this).attr("x")),s=parseInt(d3.select(this).attr("y")),l=d+parseFloat(d3.select(this).attr("width"));a||t.id===e.id||n!==s||(r>=d&&r<l||o>d&&o<=l||r<d&&o>l)&&(a=!0)})),d3.select(this).attr("stroke",null),a)d3.select(this).attr("y",dragY),a=!1;else{var d=scaleBandInvert(yScale)(t.y);dataCases=d3.map(dataCases,(function(t){return _objectSpread(_objectSpread({},t),t.id===e.id&&{room:d})}))}}function drawBars(t){var e=yScale.bandwidth();svg.selectAll("rect").data(t).join((function(t){return t.append("rect").attr("class","rect").attr("fill",(function(t,e){return color(e)})).attr("width",0).attr("height",e).attr("x",(function(t){return xScale(new Date(t.initDate))+1*xOffset})).attr("y",(function(t){return yScale(t.room)})).call((function(t){return t.transition().delay((function(t,e){return 60*e})).attr("width",(function(t){var e=xScale(new Date(t.initDate));return xScale(new Date(t.endDate))-e}))}),(function(t){return t.transition().delay((function(t,e){return 60*e})).attr("width",(function(t){var e=xScale(new Date(t.initDate));return xScale(new Date(t.endDate))-e})).attr("height",e).attr("y",(function(t){return xScale(t.room)+e/2}))}),(function(t){return t.transition().delay((function(t,e){return 60*e})).attr("width",0).remove()}))})).call(d3.drag().on("start",dragStarted).on("drag",dragged).on("end",dragEnded))}function draw(t){updateXScaleDomain(t),updateYScaleDomain(t),drawXAxis(),drawYAxis(),drawVerticalLines(),drawBars(t)}d3.json("assets/stubs/reservations.json").then((function(t){dataCases=t,draw(t)})),$(".input-daterange").datepicker({format:"yyyy-mm-dd",startDate:"2021-01-01",endDate:"2021-01-31",autoclose:!0}),$("#reservation-form").validate({rules:{start:{required:!0},end:{required:!0},room:{required:!0}},messages:{start:"",end:"",room:""},submitHandler:function(t){var e=$("#room").val(),a=$("#start-date").val(),r=$("#end-date").val();dataCases.find((function(t){return t.room===e&&t.initDate>=a&&t.initDate<r}))?$("#error-modal").modal():(dataCases.push({id:uuidv4(),room:e,initDate:a,endDate:r,name:"XXXXXXXXX"}),drawBars(dataCases))}});